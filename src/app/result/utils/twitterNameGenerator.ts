import { ImageAnalysisResult, TRAIT_LABELS, TraitScores } from '@/types/analysis'

/**
 * ë¯¸ì¹œ ì£¼ì ‘ ìƒì„±ê¸° ğŸ”¥
 * íŠ¸ìœ„í„°/ë•ì§ˆ ê°ì„± í­ë°œí•˜ëŠ” ë¬¸êµ¬ ìƒì„±
 */
export const generateTwitterName = (analysisResult: ImageAnalysisResult): string => {
  if (!analysisResult || !analysisResult.traits || !analysisResult.matchingKeywords) {
    return 'ì¡´ì¬ ìì²´ê°€ ì‚¬ê±´ì‚¬ê³ ê¸‰ ë¹„ì£¼ì–¼ í…ŒëŸ¬ë¦¬ìŠ¤íŠ¸'
  }

  // ìƒìœ„ 3ê°œ íŠ¹ì„± ì¶”ì¶œ
  const sortedTraits = Object.entries(analysisResult.traits)
    .sort(([, valueA], [, valueB]) => valueB - valueA)
    .slice(0, 3)
    .map(([key]) => key as keyof TraitScores)

  // ë§¤ì¹­ í‚¤ì›Œë“œì—ì„œ ëœë¤í•˜ê²Œ 2ê°œ ì„ íƒ
  const randomKeywords = [...analysisResult.matchingKeywords]
    .sort(() => 0.5 - Math.random())
    .slice(0, 2)

  const keyword1 = randomKeywords[0] || 'ë ˆì „ë“œ'
  const keyword2 = randomKeywords[1] || 'ë¯¸ì¹œ ì¡´ì¬ê°'
  const trait = TRAIT_LABELS[sortedTraits[0]] || 'ë¯¸ì¹¨'

  // ğŸ”¥ ë¯¸ì¹œ ì£¼ì ‘ íŒ¨í„´ë“¤ - ì§„ì§œ ë•ì§ˆ ê°ì„± í­ë°œ
  const patterns = [
    // ğŸŒŸ ëˆˆ ê´€ë ¨ ê·¹ì°¬
    `ì•—! ì–´ë””ì„œ í•´ê°€ ë–´ë‚˜ í–ˆë”ë‹ˆ ${keyword1}ì˜ ëˆˆë§ìš¸ì´ì—ˆë„¤... ëˆˆì´ ë©€ì–´ë²„ë ·!!!!`,
    `ì € ëˆˆë¹› ë­ì„?? ${keyword1} ì¥ì°©í•˜ê³  ì‚¬ëŒ í™€ë¦¬ëŠ” ê±° ë¶ˆë²• ì•„ë‹™ë‹ˆê¹Œ??`,
    `ëˆˆì—ì„œ ${keyword1}ì´ ìŸì•„ì§€ëŠ”ë°ìš”... ì € ì§€ê¸ˆ ìµì‚¬ ì¤‘ì´ì—ìš”...`,
    `${keyword1} ë‹´ì€ ëˆˆë™ì ë³´ê³  3ì¼ì§¸ í—¤ì–´ë‚˜ì˜¤ì§ˆ ëª»í•˜ëŠ” ì¤‘`,

    // ğŸ”¥ ê³¼ëª°ì… ê´‘ê¸°
    `ì–´ë¨¸ë‹˜ ì € ${keyword1} ë•Œë¬¸ì— ë¯¸ì³ë²„ë¦´ ê²ƒ ê°™ì•„ìš” í–‰ë³µí•´ìš”`,
    `${keyword1} ë³´ëŠ” ìˆœê°„ ë‡Œê°€ "ì™€ì•„ì•„ì•„ì•„ì•™!!!!!!" ì´ëŸ¬ê³  ì…§ë‹¤ìš´ë¨`,
    `ì œ ë‡Œ: ${keyword1}... ${keyword1}... ${keyword1}... (ë¬´í•œë°˜ë³µ)`,
    `${keyword1} í•œ ì¥ì— ì‹¬ì¥ì´ 87ë²ˆ ë›°ì—ˆìŠµë‹ˆë‹¤ (ì‹¤í™”)`,
    `ì‚´ë ¤ì£¼ì„¸ìš” ${keyword1}ì— ì¤‘ë…ëì–´ìš” ì¹˜ë£Œ ì•ˆ ë°›ì„ ê±°ì˜ˆìš”`,

    // ğŸ’€ ì£½ìŒ ë“œë¦½
    `${keyword1} ì§ë¹µìœ¼ë¡œ ì‹¬ì¥ì— ê½‚í˜”ìŠµë‹ˆë‹¤... ì „ ì´ë¯¸ ëŠ¦ì—ˆì–´ìš”...`,
    `ìœ ì–¸: ${keyword1} ë•Œë¬¸ì— ì£½ì–´ë„ ì—¬í•œì´ ì—†ìŠµë‹ˆë‹¤`,
    `${keyword1} ë³´ê³  ìŠ¹ì²œí•˜ëŠ” ì¤‘... ë‹¤ë“¤ ì˜ ì‚´ì•„...`,
    `ì•„ ${keyword1} ë•Œë¬¸ì— ì£½ì—ˆë‹¤ ì‚´ì•„ë‚¬ë‹¤ ë°˜ë³µ ì¤‘`,

    // ğŸ­ ì—°ê·¹/ëŒ€ì‚¬ íŒ¨ëŸ¬ë””
    `"${keyword1}ì´ ë­ê¸¸ë˜..." í–ˆëŠ”ë° ì´ì œ ì••ë‹ˆë‹¤. ì¸ìƒì´ë”ë¼ê³ ìš”.`,
    `${keyword1}... ê·¸ê²ƒì€... ì¸ë¥˜ê°€ ë„ë‹¬í•  ìˆ˜ ì—†ëŠ” ê²½ì§€...`,
    `ì „ì„¤ì€ ì•„ë‹ˆ ë ˆì „ë“œê°€ ì•„ë‹ˆ ê·¸ëƒ¥ ${keyword1} ê·¸ ìì²´`,
    `${keyword1}ì„ ì˜ì ‘í•˜ì˜µë‹ˆë‹¤... (í°ì ˆ)`,

    // ğŸ¤¯ ë‡Œì ˆ ê·¹í•œ
    `${keyword1} ${keyword2} ì´ ì¡°í•© ì‹¤í™”ëƒê³ ìš”!!!! í•©ë²•ì´ëƒê³ ìš”!!!!`,
    `ì•„ë‹ˆ ê·¼ë° ì§„ì§œ ${keyword1}ì´ ë§ì´ ë¼??? ë§ì´ ë˜ëƒê³ ???`,
    `${keyword1} ë³´ê³  ì†Œë¦¬ ì§€ë¥´ë‹¤ê°€ ëª© ë‚˜ê° ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹ í–‰ë³µ`,
    `ë¯¸ì³¤ë‹¤ë¯¸ì³¤ë‹¤ë¯¸ì³¤ë‹¤ ${keyword1} ë¯¸ì³¤ë‹¤!!!!!!!`,

    // ğŸŒ¸ ë¡œë§¨ìŠ¤ ê°ì„±
    `${keyword1}... ë‹¹ì‹ ì„ ë§Œë‚œ ê±´ ìš´ëª…ì´ì—ˆì–´ìš”... (ê°ë™ì˜ ëˆˆë¬¼)`,
    `${keyword1}í•œí…Œ ì‹¬ì¥ ë„ë‘‘ë§ì•˜ëŠ”ë° ì‹ ê³  ì•ˆ í• ê²Œìš”... ê°€ì ¸ê°€ì„¸ìš”...`,
    `ì˜¤ëŠ˜ë¶€í„° ${keyword1}ë§Œ ë³´ê³  ì‚´ê² ìŠµë‹ˆë‹¤ (ì§„ì§€)`,
    `${keyword1}ì•„ ì‚¬ë‘í•´!!!!!!! (ë²½ì¿µë‹¹í•¨)`,

    // ğŸ“¢ ë°©ì†¡/ì‹¤í™© ì»¨ì…‰
    `[ì†ë³´] ${keyword1} ë“±ì¥ì— ì „ ì„¸ê³„ ì‹¬ì¥ë§ˆë¹„ ê¸‰ì¦`,
    `[ê¸´ê¸‰] ${keyword1}ìœ¼ë¡œ ì¸í•œ ëŒ€ê·œëª¨ ì…ë• ì‚¬íƒœ ë°œìƒ`,
    `ì‹¤ì‹œê°„ ${keyword1} ëª©ê²©ë‹´: "ì‹¤ë¬¼ ë³´ê³  ê¸°ì ˆí•¨"`,
    `${keyword1} ì‹¤ë¬¼ ì˜ì ‘í•œ ì‚¬ëŒë“¤ì˜ ê³µí†µ ë°˜ì‘: "í—‰... í—ˆ... í•˜..."`,

    // ğŸ† ë¹„êµë¶ˆê°€ ì°¬ì–‘
    `${keyword1}? ì•„ ê·¸ ì¸ê°„ê³„ì— ì ì‹œ ë†€ëŸ¬ì˜¨ ì‹ ì´ìš”?`,
    `${keyword1}ê¸‰ ${trait}ì€ 100ë…„ì— í•œ ë²ˆ ë‚˜ì˜¬ê¹Œ ë§ê¹Œì„`,
    `${keyword1} ì•ì—ì„  ë‹¤ë“¤ ê·¸ëƒ¥ ì¼ë°˜ì¸ì´ì—ìš” ì¸ì •?`,
    `${trait}ì˜ ëíŒì™•? ì•„ë‹ˆ ${keyword1}ì€ ëíŒ"ì‹ "ì„`,

    // ğŸª ì˜¤ê¸€ê±°ë¦¼ í­ë°œ
    `ì›Œë©”~ ${keyword1} í•œ ìŠ¤í‘¼ì´ë©´ ì „ ì„¸ê³„ê°€ í™€ë”± ë°˜í•˜ê²„ë„¤~`,
    `${keyword1} ë³´ê³  ì‹¬ì¿µì‚¬ í•  ë»”... ì•„ì§ ì‚´ì•„ìˆì–´ìš” ë‹¤í–‰íˆ...`,
    `ì—„ë§ˆ ë‚˜ ${keyword1} ì°¾ì•˜ì–´... ì´ ì‚¬ëŒì´ì•¼... (ëˆˆë¬¼)`,
    `${keyword1}ì˜ ${trait}ì— ì·¨í•´ì„œ ì§‘ì— ëª» ê°€ëŠ” ì¤‘...`,

    // ğŸŒˆ ê°íƒ„ì‚¬ ì—°ë°œ
    `í—... ëŒ€ë°•... ë¯¸ì³¤ë‹¤... ${keyword1}... ì–´ë–»ê²Œ... ì´ëŸ°...`,
    `ã…ã…Š... ${keyword1}... ì§„ì§œ... ì™€... ì•„... ë§ì‡ëª»...`,
    `${keyword1} ë­ì•¼... ë­ëƒê³ ... ë­”ë°... ì–´ë–»ê²Œ... ì™œ...`,

    // ğŸ¯ ì§ì„¤ì  ê·¹ì°¬
    `${keyword1}+${keyword2} ì¡°í•© = í•©ë²•ì  ì‹¬ì¥ í…ŒëŸ¬`,
    `ì–¼êµ´ì—ì„œ ${keyword1}ì´ ëšëš íë¥´ëŠ” ê±° ì‹¤í™”ì„?`,
    `ê±¸ì–´ë‹¤ë‹ˆëŠ” ${keyword1} ë§›ì§‘... ë§¤ì¼ ì˜ì—…í•´ì£¼ì„¸ìš”...`,
    `${trait} ì¥ì°©í•˜ê³  ${keyword1}ê¹Œì§€? ë¨¼ì¹˜í‚¨ì´ì‹œë„¤ìš”?`,
  ]

  const selectedPattern = patterns[Math.floor(Math.random() * patterns.length)]
  return selectedPattern
}

/**
 * ë¶€ê°€ í•´ì‹œíƒœê·¸ ìƒì„± - ë•ì§ˆ ê°ì„± í’€ì¶©ì „
 */
export const generateHashtags = (analysisResult: ImageAnalysisResult): string[] => {
  const baseHashtags = ['#AC_SCENT', '#í–¥ìˆ˜ì¶”ì²œ', '#ì…ë•ê°']

  if (!analysisResult?.matchingKeywords) return baseHashtags

  const keywordTags = analysisResult.matchingKeywords
    .slice(0, 2)
    .map(k => `#${k.replace(/\s/g, '')}`)

  const extraTags = [
    '#ë¹„ì£¼ì–¼_ë¯¸ì³¤ë‹¤',
    '#ì‹¬ì¥ì•„_ë‚˜ì‚´ì•„',
    '#ì¡´ì˜ì¡´ì˜ˆ',
    '#ë ˆì „ë“œê¸‰',
    '#ê°“ë²½',
    '#ìµœì• ë“±ê·¹',
    '#ì·¨ì €',
    '#ì…ë•ì™„ë£Œ'
  ]

  const randomExtra = extraTags[Math.floor(Math.random() * extraTags.length)]

  return [...baseHashtags, ...keywordTags, randomExtra]
}
